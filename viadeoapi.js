typeof window=="undefined"&&(window=function(){}),typeof module=="undefined"&&typeof window.module=="undefined"&&(module={});var apimodule_prelude=function(a){var b={_apiKey:null,_session:null,_userStatus:"unknown",_cookieName:null,_logging:!0,copy:function(a,b,c,d){for(var e in b)if(c||typeof a[e]=="undefined")a[e]=d?d(b[e]):b[e];return a},create:function(b,c){var d=a,e=b?b.split("."):[],f=e.length;for(var g=0;g<f;g++){var h=e[g],i=d[h];i||(i=c&&g+1==f?c:{},d[h]=i),d=i}return d},provide:function(b,c,d){return a.copy(typeof b=="string"?a.create(b):b,c,d)},guid:function(){return"f"+(Math.random()*(1<<30)).toString(16).replace(".","")},log:function(b){a._logging&&(window.Debug&&window.Debug.writeln?window.Debug.writeln(b):window.console&&window.console.log(b)),a.Event&&a.Event.fire("vd.log",b)},error:function(b){window.console&&window.console.error("Error JS coverage :"+b),a.Event&&a.Event.fire("vd.error",b)},$:function(a){return document.getElementById(a)}};for(var c in b)a[c]=b[c]};typeof exports=="undefined"&&(window.exports={});var init=this.init=exports.init=apimodule_prelude;typeof window!="undefined"&&(window.VD={},init(window.VD));var VD_CONFIG=module.exports={get:function(){return{api:{oauth_uri:"https://secure.viadeo.com",oauth_token_path:"/oauth-provider/token",oauth_authorize_path:"/oauth-provider/authorize2",api_uri:"https://api.viadeo.com/"}}}};var require=require;require||(require=function(a){if(a=="viadeoapi")return{VD:VD};if(a=="config")return VD_CONFIG});var apimodule_event=function(a){a.provide("EventProvider",{subscribers:function(){this._subscribersMap||(this._subscribersMap={});return this._subscribersMap},subscribe:function(a,b){var c=this.subscribers();c[a]?c[a].push(b):c[a]=[b]},unsubscribe:function(b,c){var d=this.subscribers()[b];a.Array.forEach(d,function(a,b){a==c&&(d[b]=null)})},monitor:function(a,b){if(!b()){var c=this,d=function(){b.apply(b,arguments)&&c.unsubscribe(a,d)};this.subscribe(a,d)}},clear:function(a){delete this.subscribers()[a]},fire:function(){var b=Array.prototype.slice.call(arguments),c=b.shift();a.Array.forEach(this.subscribers()[c],function(a){a&&a.apply(this,b)})}}),a.provide("Event",a.EventProvider)},init=this.init=exports.init=apimodule_event;typeof window.document!="undefined"&&typeof XLP=="undefined"&&init(window.VD);var require=require,apimodule_qs=function(a){a.provide("QS",{encode:function(b,c,d){c=c===undefined?"&":c,d=d===!1?function(a){return a}:encodeURIComponent;var e=[];a.Array.forEach(b,function(a,b){a!==null&&typeof a!="undefined"&&e.push(d(b)+"="+d(a))}),e.sort();return e.join(c)},decode:function(a){var b=decodeURIComponent,c={},d=b(a).split("&"),e,f;for(e=0;e<d.length;e++)f=d[e].split("=",2),f&&f[0]&&(c[b(f[0])]=f[1]?b(f[1].replace(/\+/g,"%20")):"");return c}})},init=this.init=exports.init=apimodule_qs;typeof window.document!="undefined"&&typeof XLP=="undefined"&&init(window.VD);var apimodule_auth=function(a){a.provide("",{getLoginStatus:function(b){b&&b({status:a._userStatus,session:a._session})},getSession:function(){a._session&&"expires"in a._session&&a._session.expires>0&&(new Date).getTime()>a._session.expires*1e3&&a.Auth.setSession(null,"notConnected");return a._session},login:function(b,c){var d=window.location.href;if(typeof window!="undefined"&&typeof window.document!="undefined"){var e=typeof window.screenX!="undefined"?window.screenX:window.screenLeft,f=typeof window.screenY!="undefined"?window.screenY:window.screenTop,g=typeof window.outerWidth!="undefined"?window.outerWidth:document.documentElement.clientWidth,h=typeof window.outerHeight!="undefined"?window.outerHeight:document.documentElement.clientHeight-22,i=780,j=450,k=parseInt(e+(g-i)/2,10),l=parseInt(f+(h-j)/2.5,10),m="width="+i+",height="+j+",left="+k+",top="+l;c=a.copy(c||{},{client_id:a._apiKey,response_type:"token",display:"popup",scope:"",state:"vdauth_"+a.guid()});var n=a.Auth.authorizeUrl+"?"+a.QS.encode(c);n+="&"+a.QS.encode({redirect_uri:d}),n+="&"+a.QS.encode({cancel_url:d+(d.match(/\?/)?"&":"?")+"canceled=true"});if(c.display==="popup"){console.log("Open popup "+n);var o=window.open(n,"vdauth",m);b&&(a.Auth._active[c.state]={cb:b,win:o},a.Auth._popupMonitor())}else c.display=="popupInside"&&(c.display="popup"),window.location.href=n}},logout:function(b,c){a.Auth.setSession(null,"notConnected",c),a.Cookie.clear(c),b&&b()},logoutWeb:function(b,c,d){a.Cookie.clearWeb(c,d),b&&b()}});var b=require("config").get();a.provide("Auth",{authorizeUrl:b.api.oauth_uri+b.api.oauth_authorize_path,_active:{},_receivedSession:null,readFragment:function(){if(typeof window!="undefined"&&typeof window.document!="undefined"&&typeof window.location!="undefined"){var b=window.location.href.replace("?","#"),c=b.substr(b.lastIndexOf("#")+1);if(c.indexOf("access_token=")>=0||c.indexOf("error=")>=0){var d=a.QS.decode(c);window.opener&&window.opener.VD.Auth.setSession&&window.name=="vdauth"&&window.opener.name!="vdauth"?(document.documentElement.style.display="none",window.opener.VD.Auth.recvSession(d)):d&&"state"in d&&d.state.indexOf("vdauth_")==0&&("access_token"in d&&(a.Auth._receivedSession=d),window.location.hash=b.substr(0,b.lastIndexOf("#")))}}},recvSession:function(b){b||a.error("Received invalid session"),"error"in b&&a.error("Received auth error `"+b.error+"': "+b.error_description);if("state"in b)if(b.state in a.Auth._active)a.Auth._active[b.state].session=b;else{a.error("Received a session from an inactive window");return}else a.error("Received a session with not `state' field")},setSession:function(b,c,d){var e=!a._session&&b,f=a._session&&!b,g=!1,h=e||f||a._session&&b&&a._session.access_token!=b.access_token||a._session&&b&&a._session.expires_in!=b.expires_in,i=c!=a._userStatus;b&&"expires_in"in b&&(b.expires=Math.round((new Date).getTime()/1e3)+parseInt(b.expires_in,10),delete b.expires_in);var j={session:b,status:c};a._session=b,a._userStatus=c,b&&typeof b.access_token!="undefined"&&(a.access_token=b.access_token),h&&a.Cookie&&a.Cookie.getEnabled()&&a.Cookie.set(b,d),i&&a.Event.fire("auth.statusChange",j),(f||g)&&a.Event.fire("auth.logout",j),(e||g)&&a.Event.fire("auth.login",j),h&&a.Event.fire("auth.sessionChange",j);return j},_popupMonitor:function(){for(var b in a.Auth._active){if("win"in a.Auth._active[b])try{a.Auth._active[b].win.closed&&(delete a.Auth._active[b].win,a.Auth.recvSession({error:"access_denied",error_description:"Client closed the window",state:b}))}catch(c){}if("session"in a.Auth._active[b]){var d=a.Auth._active[b];delete a.Auth._active[b];var e=d.session;"access_token"in e?a.Auth.setSession(e,"connected"):a.Auth.setSession(null,"notConnected"),"win"in d&&d.win.close(),"cb"in d&&d.cb({status:a._userStatus,session:a._session})}}var f=!1;for(var b in a.Auth._active){f=!0;break}f&&!a.Auth._popupInterval?a.Auth._popupInterval=window.setInterval(a.Auth._popupMonitor,100):!f&&a.Auth._popupInterval&&(window.clearInterval(a.Auth._popupInterval),a.Auth._popupInterval=null)}}),a.Auth.readFragment()},init=this.init=exports.init=apimodule_auth;typeof window.document!="undefined"&&typeof XLP=="undefined"&&init(window.VD);typeof window.document=="undefined"&&(window=function(){},window.setTimeout=function(a,b){}),window.console||(window.console={log:function(a){},error:function(a){}});var require=require,apimodule_init=function(a){a.provide("",{init:function(b){b=a.copy(b||{},{logging:!0}),a._apiKey=b.apiKey;if(typeof b.cookieName=="undefined"||!b.cookieName){var c=require("config").get();typeof c.api.cookieName!="undefined"?b.cookieName=c.api.cookieName:b.cookieName=null}a._cookieName=b.cookieName||"vds_"+a._apiKey,a._accessToken=b.access_token,!b.logging&&window.location.toString().indexOf("vd_debug=1")<0&&(a._logging=!1),a._apiKey&&(a.Cookie.setEnabled(b.cookie),b.session=b.session||a.Auth._receivedSession||a.Cookie.load(),a.Auth.setSession(b.session,b.session?"connected":"unknown"),b.status&&a.getLoginStatus())}}),window.setTimeout(function(){window.vdAsyncInit&&vdAsyncInit()},0)},init=this.init=exports.init=apimodule_init;typeof window.document!="undefined"&&typeof XLP=="undefined"&&init(window.VD);var require=require,document=window.document;document=typeof document=="undefined"?{cookie:""}:document;var apimodule_cookie=function(a){a.provide("Cookie",{_domain:null,_enabled:!1,setEnabled:function(b){a.Cookie._enabled=b},getEnabled:function(){return a.Cookie._enabled},getViadeo:function(a){if(!a)cookie=document.cookie;else if(a!=-1)cookie=a.headers.cookie||"";else return null;console.log("COOKIE RAW: ",cookie),cookie=cookie.match("\\brememberMe=([^;,]*)\\b"),cookie&&console.log("CATCHED: ",cookie[1]);return cookie?cookie[1]:null},load:function(b){var c=null,d=null,e=a._cookieName;if(!b)c=document.cookie;else if(b!=-1)c=b.headers.cookie||"";else return null;c=c.match("\\b"+e+'="?([^;,]*)\\b'),vd=a.Cookie.getViadeo(b),console.log("COOKIE VD IN LOAD: "+vd);if(c){d=a.QS.decode(c[1]),console.log("SESSION FROM COOKIE: ",d);if(vd!=d.vd){console.log("RETURN NULL COOKIE");return null}d.expires=parseInt(d.expires,10),a.Cookie._domain=d.base_domain}return d},setRaw:function(b,c,d,e,f){var g=f||a._cookieName,h=b&&c==0?null:new Date(c*1e3),e;typeof window.document=="undefined"?e&&e.res.cookie(g,b,{expires:h,domain:d,path:"/",httpOnly:!1}):document.cookie=g+'="'+b+'"'+(h?"; expires="+h:"")+"; path=/"+(d?"; domain="+d:"")},set:function(b,c){b&&(b.vd=a.Cookie.getViadeo(c),console.log("SET VD COOKIE: ",b),isNaN(b.expires)&&(b.expires=0),a.Cookie.setRaw(a.QS.encode(b),b.expires,b.base_domain,c),a.Cookie._domain=b.base_domain)},clear:function(b){console.log("clear cookie"),a.Cookie.setRaw("",0,a.Cookie._domain,b)},clearWeb:function(b,c){console.log("clear web cookie");var d=["apiRememberMe","rememberMe","autoReconnect","stayConnected"];for(id in d)a.Cookie.setRaw("",0,c,b,d[id])}})},init=this.init=exports.init=apimodule_cookie;typeof window.document!="undefined"&&typeof XLP=="undefined"&&init(window.VD);this.JSON||(this.JSON={}),function(){function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g;return e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)d=rep[c],typeof d=="string"&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g;return e}}function quote(a){escapable.lastIndex=0;return escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function f(a){return a<10?"0"+a:a}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return str("",{"":a});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver=="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")})}();var require=require,apimodule_array=function(a){a.provide("Array",{indexOf:function(a,b){if(a.indexOf)return a.indexOf(b);var c=a.length;if(c)for(var d=0;d<c;d++)if(a[d]===b)return d;return-1},merge:function(b,c){for(var d=0;d<c.length;d++)a.Array.indexOf(b,c[d])<0&&b.push(c[d]);return b},filter:function(a,b){var c=[];for(var d=0;d<a.length;d++)b(a[d])&&c.push(a[d]);return c},keys:function(a,b){var c=[];for(var d in a)(b||a.hasOwnProperty(d))&&c.push(d);return c},map:function(a,b){var c=[];for(var d=0;d<a.length;d++)c.push(b(a[d]));return c},forEach:function(a,b,c){if(!!a)if(Object.prototype.toString.apply(a)!=="[object Array]"&&(a instanceof Function||typeof a.length!="number"))for(var f in a)(c||a.hasOwnProperty(f))&&b(a[f],f,a);else if(a.forEach)a.forEach(b);else for(var d=0,e=a.length;d<e;d++)b(a[d],d,a)}})},init=this.init=exports.init=apimodule_array;typeof window.document!="undefined"&&typeof XLP=="undefined"&&init(window.VD);var require=require,apimodule_json=function(a){a.provide("JSON",{stringify:function(a){try{return window.Prototype&&Object.toJSON?Object.toJSON(a):JSON.stringify(a)}catch(b){console.log("ERROR when stringigy data :"),console.log(a);throw b}},parse:function(a){return JSON.parse(a)},flatten:function(b){var c={};for(var d in b)if(b.hasOwnProperty(d)){var e=b[d];if(null===e||undefined===e)continue;typeof e=="string"?c[d]=e:c[d]=a.JSON.stringify(e)}return c}})},init=this.init=exports.init=apimodule_json;typeof window.document!="undefined"&&typeof XLP=="undefined"&&init(window.VD);var apimodule_network=function(a){if(typeof window.document!="undefined")console.log("NETWORK IN BROWSER"),a.provide("Network",{connect:function(b,c,d,e){var f=a.guid(),g=document.createElement("script");c&&c!="get"&&c!="GET"&&(d.method=c),d.jsonp="VD.ApiServer._callbacks."+f;var h=a.ApiServer.endpoint+b+(b.indexOf("?")>-1?"&":"?")+a.QS.encode(d);if(h.length>2e3)throw new Error("JSONP only support a maximum of 2000 bytes of input.");a.ApiServer._callbacks[f]=function(b){e&&e(b),delete a.ApiServer._callbacks[f],g.src=null,g.parentNode.removeChild(g)},g.src=h,document.getElementsByTagName("head")[0].appendChild(g)}});else{var b=require("log4js"),c=b.getLogger("api/network"),d=b.getLogger("api/network/data");console.log("NETWORK IN NODE"),a.provide("Network",{connect:function(b,e,f,g){var h=a.guid(),i=a.ApiServer.proto=="https"?require("https"):require("http"),j=function(a,b){return{error:{type:a,message:[b]}}};e&&(e=e.toUpperCase()),e&&e=="GET"&&(f.method=null);var k=a.QS.encode(f);!e||e!="POST"&&e!="PUT"?b="/"+b+(b.indexOf("?")>-1?"&":"?")+k:(b="/"+b+(b.indexOf("?")>-1?"&":"?")+"access_token="+f.access_token,f.access_token=null,k=a.QS.encode(f));var l={host:a.ApiServer.host,port:a.ApiServer.port,path:b,method:e};d.debug("API "+h+" CONNECT : '",l);for(var m in f){var n=f[m];n&&d.debug("API "+h+" PARAM : '"+m+"': "+n.substring(0,50)+(n.length>50?"...":""))}e&&(e=="POST"||e=="PUT")&&(l.headers={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","Content-Length":k.length}),c.debug("API "+h+": "+b);var o=i.request(l);e&&(e=="POST"||e=="PUT")&&o.write(k),o.end(),c.debug("API "+h+": REQUEST SENT"),o.on("response",function(a){c.debug("API "+h+": RESPONSE RECEIVED");var b="",e=parseInt(a.statusCode/100)*100;c.debug("API "+h+": statusCode: ",a.statusCode),d.debug("API "+h+": headers: ",a.headers),a.on("data",function(a){b+=a}),a.on("end",function(){c.debug("API "+h+": REQUEST ENDED");if(g){try{b=JSON.parse(b)}catch(d){c.error("API "+h+": JSON parse error: "+d),c.error(b),b={data:b}}c.debug(e),e!=200?b?g(b,a.statusCode):g(j("API Error",d),a.statusCode):g(b,a.statusCode)}})}),o.on("error",function(a){console.error("HTTP error: "+a),g(j("Connection Error",a))})}})}},init=this.init=exports.init=apimodule_network;typeof window.document!="undefined"&&typeof XLP=="undefined"&&init(window.VD);var apimodule_api=function(a){a.provide("",{api:function(){a.ApiServer.call.apply(a.ApiServer,arguments)}});var b=require("config").get(),c=b.api.api_uri;a.provide("ApiServer",{METHODS:["get","post","put","delete"],endpoint:undefined,host:undefined,port:undefined,proto:undefined,_callbacks:{},setUrl:function(b){b=b||c;var d=/^(https?):\/\/([^\/:]+)(:([0-9]+))?\/?$/,e=d.exec(b);a.ApiServer.proto=e[1];try{a.ApiServer.port=e[4]}catch(f){}a.ApiServer.port||(a.ApiServer.port=a.ApiServer.proto=="http"?80:443),a.ApiServer.host=e[2],a.ApiServer.endpoint=b},call:function(){var b=Array.prototype.slice.call(arguments),c=b.shift(),d=b.shift(),e,f,g;while(d){var h=typeof d;if(h==="string"&&!e)e=d.toLowerCase();else if(h==="function"&&!g)g=d;else if(h==="object"&&!f)f=d;else{a.log("Invalid argument passed to VD.api(): "+d);return}d=b.shift()}e=e||"get",f=f||{},c[0]==="/"&&(c=c.substr(1));a.Array.indexOf(a.ApiServer.METHODS,e)<0?a.log("Invalid method passed to VD.api(): "+e):a.ApiServer.oauthRequest(c,e,f,g)},oauthRequest:function(b,c,d,e){if(a.getSession){var f=a.getSession();f&&f.access_token&&!d.access_token&&(d.access_token=f.access_token)}!d.access_token&&a._accessToken&&(d.access_token=a._accessToken),a.Network.connect(b,c,a.JSON.flatten(d),e)}}),a.ApiServer.setUrl()},init=this.init=exports.init=apimodule_api;typeof window.document!="undefined"&&typeof XLP=="undefined"&&init(window.VD);
